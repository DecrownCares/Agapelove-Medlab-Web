<!DOCTYPE html>
<html lang="en">

<head>
    <title>Reset Password - Agapelove Medical Laboratory & Diagnostics Ltd (AMLAD)</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="AMLAD - Management Dashboard">
    <meta name="author" content="Decrowncares Solutions">    
    <link rel="shortcut icon" href="/img/AMLAD-LOGO.jpg" type="image/jpg"> 
    <link rel="icon" type="image/png" sizes="16x16" href="/img/AMLAD-LOGO.jpg">
    <link rel="icon" type="image/png" sizes="512x512" href="/img/AMLAD-LOGO.jpg">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/AMLAD-LOGO.jpg">
    <link href="/img/AMLAD-LOGO.jpg" type="image/png" rel="icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/AMLAD-LOGO.jpg">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/AMLAD-LOGO.jpg">
    <link rel="manifest" href="/manifest.json">
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Red+Rose:wght@600;700&display=swap"
        rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome JS-->
    <script defer src="plugins/fontawesome/js/all.min.js"></script>

    <!-- App CSS -->
    <link id="theme-style" rel="stylesheet" href="css/login.css">
    <!-- <link href="css/style.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="app app-reset-password p-0">
    <!-- Spinner Start -->
    <div id="spinner"
        class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
    </div>
    <!-- Spinner End -->

    <div class="row g-0 app-auth-wrapper">
        <div class="col-12 col-md-7 col-lg-6 auth-main-col text-center p-5">
            <div class="d-flex flex-column align-content-end">
                <div class="app-auth-body mx-auto">
                    <div class="app-auth-branding mb-4">
                        <a class="app-logo" href="/"><img class="logo-icon me-2" src="images/AMLAD-LOGO.jpg"
                                alt="logo"></a>
                    </div>
                    <h2 class="auth-heading text-center mb-4">Reset Your Password</h2>

                    <div class="auth-intro mb-4 text-center">Enter your new password along with the reset token sent to
                        your email.</div>

                    <div class="auth-form-container text-left">
                        <form id="reset-password-form" class="auth-form resetpass-form">
                            <!-- <div class="email mb-3">
                                <label class="sr-only" for="email">Your Email</label>
                                <input id="email" name="email" type="email" class="form-control login-email"
                                    placeholder="Your Email" required>
                            </div>

                            <div class="token mb-3">
                                <label class="sr-only" for="token">Reset Token</label>
                                <input id="token" name="token" type="text" class="form-control"
                                    placeholder="Enter Reset Token" required>
                            </div> -->

                            <input type="hidden" id="token">
                            <input type="hidden" id="email">

                            <div class="password mb-3">
                                <label class="sr-only" for="new-password">New Password</label>
                                <input id="new-password" name="new-password" type="password" class="form-control"
                                    placeholder="New Password" required>
                            </div>

                            <div class="password mb-3">
                                <label class="sr-only" for="new-password">Confirm Password</label>
                                <input id="confirm-password" name="confirm-password" type="password"
                                    class="form-control" placeholder="New Password" required>
                            </div>

                            <div class="text-center">
                                <button type="submit" class="btn app-btn-primary btn-block theme-btn mx-auto">Update
                                    Password</button>
                            </div>
                        </form>

                        <div class="auth-option text-center pt-5">
                            <a class="app-link" href="/login">Back to Login</a>
                        </div>
                    </div><!--//auth-form-container-->
                </div><!--//auth-body-->

                <footer class="app-footer">
                    <div class="container text-center py-3">
                        <small class="copyright">&copy; <span id="get-year"></span> <a class="app-link"
                                href="/">AMLAD</a>. All Rights Reserved.</small>

                    </div>
                    <script>
                        document.getElementById('get-year').innerHTML = new Date().getFullYear();
                    </script>
                </footer><!--//app-auth-footer-->
            </div><!--//flex-column-->
        </div><!--//auth-main-col-->

        <div class="col-12 col-md-5 col-lg-6 h-100 auth-background-col">
            <div class="auth-background-holder"></div>
            <div class="auth-background-mask"></div>
            <div class="auth-background-overlay p-3 p-lg-5">
                <div class="d-flex flex-column align-content-end h-100">
                    <div class="h-100"></div>
                    <div class="overlay-content p-3 p-lg-4 rounded">
                        <h5 class="mb-3 overlay-title">Create a New Password</h5>
                        <div>
                            You're just one step away from regaining access to your account.
                            Enter a new secure password below to complete the reset process.
                            Make sure your new password is strong and easy for you to remember.
                        </div>
                    </div>

                </div>
            </div><!--//auth-background-overlay-->
        </div>

        <div id="notification" class="notification bottom-right"></div>

        <!--General Loading Indicator -->
        <div id="loadingIndicator" style="z-index: 9999;" class="loading-overlay d-none">
            <div class="loading-content">
                <div class="spinner-border text-primary" role="status"></div>
                <p>Processing... Please wait</p>
            </div>
        </div>

        <div id="successModal" class="modal fade" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title">Success</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Password Reset was successful! <br> Click (Ok) to continue to the login page</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
                    </div>
                </div>
            </div>
        </div><!--//auth-background-col-->
    </div><!--//row-->

    <!-- JavaScript -->
    <script>
        function showNotificationTopRight(message, type = 'success', position = 'top-right', timeout = 5000) {
            const notification = document.getElementById('notification');
            notification.className = `notification ${type} ${position} show`;
            notification.textContent = message;

            // Hide notification after timeout
            setTimeout(() => {
                notification.classList.remove('show');
            }, timeout);
        }


        document.addEventListener("DOMContentLoaded", () => {
            // Extract token and email from URL
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get("token");
            const email = urlParams.get("email");

            // Auto-fill the hidden input fields (if they exist in your form)
            if (token) {
                document.getElementById("token").value = token;
            }
            if (email) {
                document.getElementById("email").value = email;
            }

            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword !== confirmPassword) {
                showNotificationTopRight('Passwords do not match!', 'error');
                return;
            }

            document.getElementById("reset-password-form").addEventListener("submit", async function (event) {
                event.preventDefault();

                const newPassword = document.getElementById("new-password").value;

                showLoading();

                const response = await fetch("https://agapelove-medlab-ms.onrender.com/api/auth/patient/reset-password/confirm", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, token, newPassword }),
                });

                const result = await response.json();

                if (response.ok) {
                    setTimeout(() => {
                        hideLoading();
                        document.getElementById('reset-password-form').reset();
                        showSuccessMessage();
                    }, 2000);

                    setTimeout(() => {
                        window.location.href = "/login";
                    }, 10000);
                } else {
                    hideLoading();
                    showNotificationTopRight(result.message || "An error occurred.", 'error');
                }
            });

            function showLoading() {
                document.getElementById('loadingIndicator').classList.remove('d-none');
            }

            function hideLoading() {
                document.getElementById('loadingIndicator').classList.add('d-none');
            }

            function showSuccessMessage() {
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show();
            }
        });

    </script>

    <!-- JavaScript Libraries -->
    <!-- // charts library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Javascript -->
    <script src="plugins/popper.min.js"></script>
    <script src="plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- Charts JS -->
    <script src="plugins/chart.js/chart.min.js"></script>
    <!-- <script src="js/index-charts.js"></script> -->

    <!-- Page Specific JS -->
    <script src="scripts/app.js"></script>
    <!-- <script src="scripts/dashboard.js"></script> -->
    <!-- <script src="scripts/regSample.js"></script> -->
    <script src="scripts/main.js"></script>
    <script src="scripts/charts-demo.js"></script>
    <!-- <script src="js/login.js"></script> -->

</body>

</html>